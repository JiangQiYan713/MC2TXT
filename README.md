# MC2TXT
优化版舞立方谱面转换工具，支持变化 BPM。

在现有的舞立方自制谱平台上，官方转谱器存在一个明显不足：它无法正确转换包含 BPM 变化的 mc 文件。这对于喜欢多变节奏歌曲的谱师来说，无疑是个遗憾。为此，我开发了一个全新优化的网页工具，专门针对包含变化 BPM 的 mc 文件进行转换，将其转换成仅舞立方自制谱上传工具可用的 txt 格式，从而让谱面分享和数据分析更加方便。

## MC 文件与 TXT 文件的区别

MC 文件（或称谱面文件）通常采用 JSON 格式，详细记录了Malody谱面中的各项信息：

Meta 信息：包含歌曲名称、艺术家、难度配置等基本参数。

Time 列表：记录了不同区段的 BPM 变化。例如，一个谱面中可能有多个 BPM 转换点，起始 BPM 为 141.0，而在后续的某个位置可能切换到 180 或 200 BPM，这样可以使歌曲节奏更加丰富多变。

Note 列表：列出了所有音符的时间信息、所在轨道、是否为长条音符（通过 endbeat 来标识）等。

附加属性：例如 offset、音量以及 sound 文件引用等信息。

而 TXT 文件 则是一种经过转换后的简单格式，记录了每个音符在基准 BPM 下的相对到达节拍，格式通常为：

单个音符：轨道-相对节拍（如 2-34）

长条音符：轨道-起始相对节拍-结束相对节拍（如 2-0-1.5）

这种 TXT 格式便于后续的谱面编辑、分享以及用于其他工具的二次加工并且可以防止有人写病毒）。。

## 网页工具的基本运行原理

我的网页工具通过前端 JavaScript 实现了以下主要功能：

### 1.文件导入与解析

用户上传 MC 文件后，工具通过 FileReader 读取文件内容，并将 JSON 格式的数据解析出来。

### 2.BPM 与 Offset 的计算

BPM 计算：

工具首先从 time 列表中获取基准 BPM（通常是列表中第一个元素的 BPM 值）。同时，网页上会显示所有 BPM 变化区间，以表格形式列出每个变化点的起始 beat 和 BPM，便于用户检查和验证谱面信息。
起始时间计算：

以第一个音符的 beat 作为基准，通过公式
```
起始时间 = 60 / BPM * 第一个 note 的 beat - offset / 1000
```
来计算音符真正到达的时间（单位：秒）。

### 3.音符的节拍转换

对于每个 note，工具会将其原始 beat（由数组如 [1,0,4] 表示，转换为 1.0 这一浮点值）转换到基准 BPM 下的等效节拍。

如果 note 是长条音符（具有 endbeat 字段），会同时计算其起始和结束 beat；

对于单个音符，则只计算其起始 beat。

计算后的相对节拍值将以 “轨道-节拍” 或 “轨道-起始节拍-结束节拍” 格式写入 TXT 文件中。

### 4.文件下载与命名

最后，生成的 TXT 文件会自动创建下载链接。为了便于识别，下载的文件名格式为 converted-原文件名.txt，例如用户上传的文件名为 xxx.mc，转换后的文件名将为 converted-xxx.txt。


